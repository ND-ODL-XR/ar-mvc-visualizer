<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Math Viewer Equation Input</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="mathquill-0.10.1/mathquill.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="mathquill-0.10.1/mathquill.js"></script>
    <script>
      var MQ = MathQuill.getInterface(2);
    </script>
    <style>
      .hidden {
        display: none !important;
      }
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }
      h5 {
        opacity: 0.7;
      }
      form {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      input[type="submit"] {
        background-color: #4caf50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      input[type="submit"]:hover {
        background-color: #45a049;
      }
      #vectorFunctionsSection {
        display: flex;
        flex-direction: row;
        align-items: center;
      }
      #equations {
        display: flex;
        flex-direction: column;
      }
      #qrcode {
        margin-top: 20px;
      }
      .math-field {
        width: 200px;
        height: 50px;
        font-size: 18px;
        margin: 0 10px;
        border: 1px solid #ccc;
        padding: 5px;
        display: inline-block;
        vertical-align: middle;
      }
      .equation {
        display: flex;
        flex-direction: row;
        align-items: center;
      }

      #equationForm {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #equation-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }
      #equals-sign {
        font-size: 24px;
        vertical-align: middle;
      }
    </style>
  </head>
  <body>
    <button id="equationTypeToggleButton">
      Switch to Vector-Valued Functions
    </button>

    <div id="implicitEquationSection">
      <form id="equationForm">
        <h2>Enter a Math Equation</h2>
        <div id="equation-container">
          <div id="leftContainer" class="equation">
            <div class="math-field" id="left"></div>
          </div>
          <div id="equals-sign">=</div>
          <div id="rightContainer" class="equation">
            <div class="math-field" id="right"></div>
          </div>
        </div>
        <input type="submit" value="Generate QR Code" />
      </form>
    </div>

    <div id="vectorFunctionsSection" class="hidden">
      <form id="vectorForm">
        <h2>Enter Vector-Valued Functions</h2>
        <div id="vectorFunction">
          <div id="leftSide">S(x,y) = [</div>
          <div id="equations">
            <div class="equation">
              <div class="math-field" id="f"></div>
            </div>
            <div class="equation">
              <div class="math-field" id="g"></div>
            </div>
            <div class="equation">
              <div class="math-field" id="h"></div>
            </div>
          <div>]</div>
        </div>
        <input type="submit" value="Generate QR Code" />
      </form>
    </div>

          <div id="qrcode"></div>


    <!-- <script>
      var latex_to_js = function(input) {

	var init, fraction, square_root, nth_root, nth_power, sin, cos, tan, sinCosTanFramework, convert_others;

	init = function() {
		var st1 = input;
		st1 = st1.replace(/\s/g, "");
		st1 = st1.replace(/\\times/g, "*");
		st1 = st1.replace(/\\div/g, "/");

		//pi
		st1 = st1.replace(/([0-9a-zA-Z\.]+)\\pi/g, "$1*3.142");
		st1 = st1.replace(/\\pi([0-9a-zA-Z\.]+)/g, "3.142*$1");
		st1 = st1.replace(/([0-9a-zA-Z\.]+)\\pi([0-9a-zA-Z\.]+)/g, "$1*3.142*$2");
		st1 = st1.replace(/\\pi/g, "3.142");

		st1 = fraction(st1);
		st1 = square_root(st1);
		st1 = nth_root(st1);
		st1 = nth_power(st1);
		st1 = sin(st1);
		st1 = tan(st1);
		st1 = cos(st1);
    

      
		//clean up brackets
		st1 = st1.replace(/\\left\(/g, "(");
		st1 = st1.replace(/\\right\)/g, ")");
		st1 = st1.replace(/\b(sin|cos|tan|log|exp|sqrt|pow)\b/g, 'Math.$1');

        // Insert * between an x or y variable and an alphanumeric character
      st1 = st1.replace(/([xy])([a-zA-Z0-9])/g, "$1*$2");
      st1 = st1.replace(/([a-zA-Z0-9])([xy])/g, "$1*$2");

      // Insert a * between a number and a variable
      st1 = st1.replace(/([0-9])(x)/g, "$1*$2");
      st1 = st1.replace(/(x)([0-9])/g, "$1*$2");
      st1 = st1.replace(/([0-9])(y)/g, "$1*$2");
      st1 = st1.replace(/(y)([0-9])/g, "$1*$2");

    console.log(st1);
    return st1;
	};

	fraction = function(input) {
		while (input.search(/\\frac\{(((?![\{\}]).)*)\}\{(((?![\{\}]).)*)\}/) >= 0) {
			
			input = input.replace(/\\frac\{(((?![\{\}]).)*)\}\{(((?![\{\}]).)*)\}/g, "($1)/($3)");
		}

		if (input.search(/\\frac/) >= 0) {
			input = convert_others("fraction", input);
		}

		return input;
	};

	square_root = function(input) {
		while (input.search(/\\sqrt\{(((?![\{\}]).)*)\}/) >= 0) {
			
			input = input.replace(/\\sqrt\{(((?![\{\}]).)*)\}/g, "sqrt($1)");
		}

		if (input.search(/\\sqrt\{/) >= 0) {
			input = convert_others("square root", input);
		}

		return input;
	};

	nth_root = function(input) {
		while (input.search(/\\sqrt\[(((?![\{\}]).)*)\]\{(((?![\{\}]).)*)\}/) >= 0) {
			
			input = input.replace(/\\sqrt\[(((?![\{\}]).)*)\]\{(((?![\{\}]).)*)\}/g, "pow($3,1/$1)");
		}
		if (input.search(/\\sqrt\[/) >= 0) {
			input = convert_others("nth root", input);
		}
		return input;
	};

	nth_power = function(input) {
		//first case: single number with curly bracket power
		while (input.search(/([0-9a-zA-Z\.]+)\^\{(((?![\{\}]).)*)\}/) >= 0) {
			
			input = input.replace(/([0-9a-zA-Z\.]+)\^\{(((?![\{\}]).)*)\}/g, "pow($1,$2)");
		}
		//second case: single number without curly bracket
		while (input.search(/([0-9a-zA-Z\.]+)\^([0-9a-zA-Z\.]+)/) >= 0) {
			
			input = input.replace(/([0-9a-zA-Z\.]+)\^([0-9a-zA-Z\.]+)/g, "pow($1,$2)");
		}

		//third case: bracket number without curly bracket power
		while (input.search(/\\left\(([0-9a-zA-Z\.\+\*\-\\]+)\\right\)\^([0-9a-zA-Z\.]+)/) >= 0) {
			
			input = input.replace(/\\left\(([0-9a-zA-Z\.\+\*\-\\]+)\\right\)\^([0-9a-zA-Z\.]+)/g, "pow($1,$2)");
		}

		//forth case: bracket number with curly bracket power
		while (input.search(/\\left\(([0-9a-zA-Z\.\+\*\-\\]+)\\right\)\^\{(((?![\{\}]).)*)\}/) >= 0) {
			
			input = input.replace(/\\left\(([0-9a-zA-Z\.\+\*\-\\]+)\\right\)\^\{(((?![\{\}]).)*)\}/g, "pow($1,$2)");
		}
		
		//fifth case: bracket number with some brackets and division sign, with curly bracket power
		while (input.search(/\\left\(([0-9a-zA-Z\.\+\*\-\\\(\)\/]+)\\right\)\^\{(((?![\{\}]).)*)\}/) >= 0) {
			
			input = input.replace(/\\left\(([0-9a-zA-Z\.\+\*\-\\\(\)\/]+)\\right\)\^\{(((?![\{\}]).)*)\}/g, "pow($1,$2)");
		}

		if (input.search(/\^/) >= 0) {
			input = convert_others("nth power", input);
		}
		return input;
	};

	sin = function(input) {

		return sinCosTanFramework("sin", input);
	};

	tan = function(input) {
		return sinCosTanFramework("tan", input);
	};

	cos = function(input) {
		return sinCosTanFramework("cos", input);
	};

	sinCosTanFramework = function(func, input) {
		var pat1 = new RegExp("\\\\" + func + "\\\\left\\(([0-9a-zA-Z\\.\\+\\*\\-\\\\\\(\\)\\/]+)\\\\right\\)");
		//eg: /\\sin\\left\(([0-9a-zA-Z\.\+\*\-\\\(\)\/]+)\\right\)/

		while (input.search(pat1) >= 0) {
			
			input = input.replace(pat1, func + "($1)");
		}
		var pat2 = new RegExp("\\\\" + func + "([0-9a-zA-Z]+)");
		//eg:  /\\sin([0-9a-zA-Z]+)/:
		
		while (input.search(pat2) >= 0) {
			
			input = input.replace(pat2, func + "($1)");
		}

		var pat3 = new RegExp("\\\\" + func);
		//eg:  /\\sin/
		if (input.search(pat3) >= 0) {
			input = convert_others(func, input);
		}

		return input;
	};

	convert_others = function(func, input) {
		var temp_input, arr, closest_pos, func_pos, frac_pos, sqrt_pos, root_pos, pow_pos;
		switch(func) {
			case "fraction":
				temp_input = input.match(/\\frac.*/)[0];
				func_pos = temp_input.search(/\\frac/);
				break;
			case "square root":
				temp_input = input.match(/\\sqrt\{.*/)[0];
				func_pos = temp_input.search(/\\sqrt\{/);
				break;
			case "nth root":
				temp_input = input.match(/\\sqrt\[.*/)[0];
				func_pos = temp_input.search(/\\sqrt\[/);
				break;
			case "nth power":
				temp_input = input.match(/\^.*/)[0];
				func_pos = temp_input.search(/\^/);
				break;
			case "sin":
				temp_input = input.match(/\\sin\{.*/)[0];
				func_pos = temp_input.search(/\\sin\{/);
				break;
			case "tan":
				temp_input = input.match(/\\tan\{.*/)[0];
				func_pos = temp_input.search(/\\tan\{/);
				break;
			case "cos":
				temp_input = input.match(/\\cos\{.*/)[0];
				func_pos = temp_input.search(/\\cos\{/);
				break;
			default:
				return;
		}
		frac_pos = temp_input.search(/\\frac/);
		sqrt_pos = temp_input.search(/\\sqrt\{/);
		root_pos = temp_input.search(/\\sqrt\[/);
		pow_pos = temp_input.search(/\^/);
		sin_pos = temp_input.search(/\\sin\{/);
		tan_pos = temp_input.search(/\\tan\{/);
		cos_pos = temp_input.search(/\\cos\{/);

		arr = [frac_pos, root_pos, sqrt_pos, pow_pos, sin_pos, tan_pos, cos_pos];
		arr.sort(function(a, b) {
			return b - a;
		});
		//desc order

		

		closest_pos = arr[arr.indexOf(0)-1];
		
		

		if (closest_pos <= 0 || closest_pos===undefined) {
			
			
			throw ("syntax error");
		}

		switch(closest_pos) {
			case frac_pos:
				input = fraction(input);
				break;
			case sqrt_pos:
				input = square_root(input);
				break;
			case root_pos:
				input = nth_root(input);
				break;
			case pow_pos:
				input = nth_power(input);
				break;
			case sin_pos:
				input = sin(input);
				break;
			case tan_pos:
				input = tan(input);
				break;
			case cos_pos:
				input = cos(input);
				break;
			default:
				
		}

		switch(func) {
			case "fraction":
				input = fraction(input);
				break;
			case "square root":
				input = square_root(input);
				break;
			case "nth root":
				input = nth_root(input);
				break;
			case "nth power":
				input = nth_power(input);
				break;
			case "sin":
				input = sin(input);
				break;
			case "tan":
				input = tan(input);
				break;
			case "cos":
				input = cos(input);
				break;
		}

		return input;
	};
	try{
		return init();
	}catch(e){
		throw("syntax error");
	}
	
};
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var MQ = MathQuill.getInterface(2);
        var mathFieldSpanLeft = document.getElementById("left");
        var mathFieldLeft = MQ.MathField(mathFieldSpanLeft, {
          spaceBehavesLikeTab: true,
        });

        var mathFieldSpanRight = document.getElementById("right");
        var mathFieldRight = MQ.MathField(mathFieldSpanRight, {
          spaceBehavesLikeTab: true,
        });

        var form = document.getElementById("equationForm");
        form.addEventListener("submit", (e) => {
          e.preventDefault();

          const left = latex_to_js(mathFieldLeft.latex());
          const right = latex_to_js(mathFieldRight.latex());
          const encodedLeft = encodeURIComponent(left);
          const encodedRight = encodeURIComponent(right);
          const url =
            "https://ndlearning.8thwall.app/ar-math-viewer/?left=" +
            encodedLeft +
            "&right=" +
            encodedRight;

          // Clear previous QR code
          document.getElementById("qrcode").innerHTML = "";

          // Generate new QR code
          new QRCode(document.getElementById("qrcode"), {
            text: url,
            width: 256,
            height: 256,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.L,
          });
        });
      });
    </script> -->
    <script>
      const toggleButton = document.getElementById("toggleButton");
      const implicitEquationSection = document.getElementById(
        "implicitEquationSection"
      );
      const vectorFunctionsSection = document.getElementById(
        "vectorFunctionsSection"
      );

      equationTypeToggleButton.addEventListener("click", () => {
        if (implicitEquationSection.classList.contains("hidden")) {
          implicitEquationSection.classList.remove("hidden");
          vectorFunctionsSection.classList.add("hidden");
          equationTypeToggleButton.textContent =
            "Switch to Vector-Valued Functions";
        } else {
          implicitEquationSection.classList.add("hidden");
          vectorFunctionsSection.classList.remove("hidden");
          equationTypeToggleButton.textContent = "Switch to Implicit Equation";
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var MQ = MathQuill.getInterface(2);
        var mathFieldSpanF = document.getElementById("f");
        var mathFieldF = MQ.MathField(mathFieldSpanF, {
          spaceBehavesLikeTab: true,
        });
        var mathFieldSpanG = document.getElementById("g");
        var mathFieldG = MQ.MathField(mathFieldSpanG, {
          spaceBehavesLikeTab: true,
        });
        var mathFieldSpanH = document.getElementById("h");
        var mathFieldH = MQ.MathField(mathFieldSpanH, {
          spaceBehavesLikeTab: true,
        });

        document
          .getElementById("vectorForm")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const url =
              "https://ndlearning.8thwall.app/ar-math-viewer/?eqf=" +
              encodeURIComponent(latex_to_js(mathFieldF.latex())) +
              "&g=" +
              encodeURIComponent(latex_to_js(mathFieldG.latex())) +
              "&h=" +
              encodeURIComponent(latex_to_js(mathFieldH.latex()));

              
            // Clear previous QR code
            document.getElementById("qrcode").innerHTML = "";

            // Generate new QR code
            new QRCode(document.getElementById("qrcode"), {
              text: url,
              width: 256,
              height: 256,
              colorDark: "#000000",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.L,
            });
          });
      });
    </script>
  </body>
</html>
